<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Predict'if</title>
        <link rel="stylesheet" href="./style/login.css" />
        <!-- Librairie Javascript: jQuery (v3.4.1) -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body class="client">
         <header>
            <div id="titre_principal">
                <div id="logo">
                    <img src="./images/logoAgence.png" alt="logo agence" />
                </div>
                <h1>Predict'if</h1>
                <div id="element">
                    <div class="boutonHeader">
                        <button id="boutonHeader" onclick="window.location= 'contact.html'">Inscription</button>
                        <button id="boutonHeader" onclick="window.location= 'contact.html'">Connexion</button>
                    </div>
                    <div class="drapeauHeader">
                        <ul class="drapeaux">
                            <li><img src="./images/drapeau_espagnol.jpg"></li>
                            <li><img src="./images/drapeau-allemand.jpg"></li>
                            <li><img src="./images/drapeau-anglais.jpg"></li>
                            <li><img src="./images/drapeau_francais.jpg"></li>
                        </ul>

                    </div>
                </div>
            </div>

            <nav class="menu">
                <ul class="gauche">
                    <li><a href="./accueil.html">Accueil</a></li>
					<li><a href="./informations.html">Qui sommes nous?</a></li>
					<li><a href="./nos-mediums.html">Nos médiums</a></li>
					<li><a href="./astro.html">Astro</a></li>
                </ul>
                <ul class="droite">
                    <li ><a href="partenaires.html">Partenaires</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </header>
        
        <h3  class="manuscrit"> Mon profil </h3> 
        <table class="TableauCentre">
            <tr>
                <td id='nomClient'  class = "sansBordure">nom prenom</td>
                <td class = "sansBordure"> </td>
            </tr>
            <tr>
                <td id='dateDeNaissance'  class = "sansBordure"> date de naissance </td>
                <td id='mail'  class = "sansBordure"> mail </td>
            </tr>
            <tr>
                <td id='adressePostale' class = "sansBordure"> adresse </td>
                <td class = "sansBordure"> <u> modifier mes données </u> </td>
            </tr>
        </table>            

        </br></br></br>

        <h3 class="manuscrit">Mon profil Astral</h3>
        </br>
        <table class="TableauCentre">
            <tr>
                <td id='signeZodiaque'  class = "sansBordure">Signe du zodiaque</td>
                <td id='couleurPB'  class = "sansBordure"> Couleur porte bonheur</td>
            </tr>
            <tr>
                <td id='signeAstroChinois'  class = "sansBordure"> Signe astrologique chinois  </td>
                <td id='animalTotem'  class = "sansBordure"> Animal totem </td>
            </tr>
        </table>      
        
        </br></br></br>

        <h3 class="manuscrit">Mon historique</h3>
        </br>
        <table class="TableauCentre">
            <tbody id ='historique'>
              
            </tbody>
        </table>   



        <script>
            
            function deconnexion(){
                $('#deconnexion').on( 'click', function () {
                    // Appel AJAX
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'deconnexion'                  
                        },
                        dataType: 'json'
                    })
                    .done( function (response) { // Fonction appelée en cas d'appel AJAX réussi
                        console.log('Response',response); // LOG dans Console Javascript
                        //window.location.reload();
                        window.location="accueil.html";
                    })
                    .fail( function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                        console.log('Error',error); // LOG dans Console Javascript
                        //alert("Erreur lors de l'appel AJAX");
                    })
                    .always( function () { // Fonction toujours appelée

                    });
                });
            }
            
            function bandeau(){
                var profil=document.getElementById("profil");
                var bandeau=document.getElementById("bandeau");
                var infosClient=document.getElementById("infosUtilisateur");

                profil.addEventListener("click", () => {
                    if(getComputedStyle(bandeau).display !== "none"){
                        bandeau.style.display = "none";
                        infosClient.style.display="none";
                    } else {
                        bandeau.style.display = "block";
                        infosClient.style.display="flex";
                    }
                });
            }




            $(document).ready( function () {
                if (document.readyState === 'complete') {
                    console.log('HTML prêt !'); // Fonction appelée lors du chargement
                    
                    // Appel AJAX
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'ChargerProfil'
                        },
                        dataType: 'json'
                    })
                    .done( function (response) { // Fonction appelée en cas d'appel AJAX réussi
                        console.log('Response',response); // LOG dans Console Javascript
                        if (response.connecte) {
                            //Profil 
                            $('#nomClient').html(response.client.prenom +" "+ response.client.nom);
                            $('#dateDeNaissance').html(response.client.dateNaissance);
                            $('#mail').html(response.client.mail);
                            $('#adressePostale').html(response.client.adressePostale);
                            //ProfilAstral 
                            $('#signeZodiaque').html("Signe du zodiaque: "+response.client.signeZodiaque);
                            $('#couleurPB').html("Couleur porte bonheur: "+response.client.couleurPB);
                            $('#animalTotem').html("Animal totem: "+response.client.animalTotem);
                            $('#signeAstroChinois').html("Signe astrologique chinois: "+response.client.signeAstroChinois); 
                            //Historique 
                            var consult = response.consultations;
                            var listeConsultation = $("#historique");
                            listeConsultation.empty () ; // Vider la liste HTML
                            $.each ( consult, function (i,consu) {
                                listeConsultation.append( // Ajouter a la liste HTML
                                "<tr> <td  class = \"bordureTabfin\" > "+ consu.medium + "</td> <td  class = \"bordureTabfin\">"+ consu.date +"</td> <td  class = \"bordureTabfin\">" + consu.note+"</td> </tr>"
                                );
                            });
                            
                            // Message pour le paragraphe de notification
                            var nomClient=response.client.nom+" "+response.client.prenom;
                            var dateNaissanceClient=response.client.date;
                            console.log(nomClient);
                            console.log(dateNaissanceClient);

                            var bandeauProfil="<div id=\"profilHeader\" >"+
                                                    "<input type=\"image\" src=\"./images/profil.png\" name=\"prof\" id=\"profil\" onclick=\"\">"+
                                                    "<div id=\"infosUtilisateur\" style=\"display:none;\">"+
                                                        "<span id=\"champ-nomProfil\">M. Durant lalalalalaaaalaa</span>"+
                                                        "<span id=\"champ-dateNaissanceProfil\">19/08/1997</span>"+
                                                    "</div> "+                          
                                                "</div>"+
                                                "<div id=\"bandeau\" style=\"display:none;\">"+
                                                    "<ul id=\"listeOptions\">"+
                                                        "<li><button class=\"joli-bouton\" id=\"compte\">Accéder à mon compte</button></li>"+
                                                        "<li><a href=\"profil.html\">Mon historique</a></li>"+
                                                        "<li><a href=\"#\">Consulter un médium</a></li>"+
                                                        "<li><a href=\"profil.html\">Mon profil Astral</a></li>"+
                                                        "<li><a href=\"#\" id=\"deconnexion\">Se déconnecter</a></li>"+
                                                    "</ul>"+   
                                                "</div>";
                        
                            $('div.boutonHeader').html(bandeauProfil);
                            $('#champ-nomProfil').html(nomClient);
                            $('#champ-dateNaissanceProfil').html(dateNaissanceClient);
                            bandeau();
                            deconnexion();

                        }else {
                            window.location = 'accueil.html';
                        }
                    })
                    .fail( function (error) { // Fonction appelée en cas d'erreur lors de l'appel AJAX
                        console.log('Error',error); // LOG dans Console Javascript
                        //alert("Erreur lors de l'appel AJAX");
                        //window.location = 'accueil.html';
                    })
                    .always( function () { // Fonction toujours appelée
                        
                    });
                };
            });


        </script>
        
    </body>
</html>
